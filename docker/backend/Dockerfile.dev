# Development Dockerfile - uses ts-node with hot reload
FROM node:20-alpine

WORKDIR /app

# Copy workspace root files
COPY package.json package-lock.json* ./
COPY shared/package.json shared/
COPY server/package.json server/

# Install all dependencies
RUN npm install --workspace=server --workspace=shared

# Copy source (will be overridden by volume mount in dev)
COPY shared/ shared/
COPY server/ server/
COPY tsconfig.base.json ./

# Create data directory
RUN mkdir -p /app/data

EXPOSE 15700
EXPOSE 15730

ENV NODE_ENV=development

WORKDIR /app/server
CMD ["npx", "nodemon"]
